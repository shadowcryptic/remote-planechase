<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Display Debug</title>
  <style>
    body { font-family: sans-serif; }
    pre { white-space: pre-wrap; word-break: break-word; }
    img { max-width: 95vw; max-height: 80vh; display: block; margin-top: 12px; }
  </style>
</head>
<body>
  <div id="status">Booting…</div>
  <pre id="dump"></pre>
  <img id="card" />

  <script type="module">
    import { db, doc, onSnapshot } from "./common.js";

    const roomId = "my-room";
    const roomRef = doc(db, "rooms", roomId);

    const status = document.getElementById("status");
    const dump = document.getElementById("dump");
    const img = document.getElementById("card");

    status.textContent = "Connecting to rooms/" + roomId + " …";

    onSnapshot(roomRef,
      (snap) => {
        if (!snap.exists()) {
          status.textContent = "Doc not found: rooms/" + roomId;
          dump.textContent = "";
          return;
        }

        const data = snap.data();
        status.textContent = "Connected. idx=" + data.idx;

        dump.textContent = JSON.stringify(data, null, 2);

        const deck = Array.isArray(data.deck) ? data.deck : [];
        const order = Array.isArray(data.order) ? data.order : [];
        const idx = typeof data.idx === "number" ? data.idx : 0;

        if (deck.length && order.length) {
          const deckIndex = order[idx] ?? 0;
          img.src = deck[deckIndex] ?? "";
        }
      },
      (err) => {
        status.textContent = "Snapshot error: " + err.message;
        dump.textContent = "";
      }
    );
  </script>
</body>
</html>
